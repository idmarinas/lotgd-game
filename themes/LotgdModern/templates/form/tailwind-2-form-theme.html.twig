{% use 'form_div_layout.html.twig' %}

{%- block form_start -%}
    {# Allow url of action #}
    {% if action %}
        {% set action = action|lotgd_url %}
    {% endif %}

    {{- parent() -}}

    {% if form.vars.label %}
        <div class="italic bg-gradient-to-r from-transparent via-lotgd-800 text-center text-xl font-bold border-b border-lotgd-500 p-2">
            {{ form.vars.label|trans({}, form.vars.translation_domain) }}
        </div>
    {% endif %}
{%- endblock form_start -%}

{%- block form_widget_simple -%}
    {%- if errors|length > 0 -%}
        {% set attr = attr|merge({class: attr.class ~ ' border-lotgd-red-400 hover:border-lotgd-red-600'}) %}
    {%- endif -%}

    {{- parent() -}}
{%- endblock form_widget_simple -%}

{%- block form_widget_compound -%}
    <div compoud {{ block('widget_container_attributes') }}>
        {%- if form is rootform -%}
            {{ form_errors(form) }}
        {%- endif -%}
        {{- block('form_rows') -}}
        {{- form_rest(form) -}}
    </div>
{%- endblock form_widget_compound -%}

{%- block form_row -%}
    {%- set row_attr = row_attr|merge({ class: row_attr.class|default(row_class|default('md:flex md:items-center mb-6')) }) -%}
    {%- set widget_attr = {} -%}
    {%- if help is not empty -%}
        {%- set widget_attr = {attr: {'aria-describedby': id ~"_help"}} -%}
    {%- endif -%}
    <div{% with {attr: row_attr} %}{{ block('attributes') }}{% endwith %}>
        {{- form_label(form) -}}
        <div class="md:w-2/3">
            {{- form_errors(form) -}}
            {{- form_widget(form, widget_attr) -}}
            {{- form_help(form) -}}
        </div>
    </div>
{%- endblock form_row -%}

{%- block form_label -%}
    {%- set label_attr = label_attr|merge({ class: label_attr.class|default(label_class|default('block font-bold md:text-right mb-1 md:mb-0 pr-4')) }) -%}
    <div class="md:w-1/3">{{- parent() -}}</div>
{%- endblock form_label -%}

{%- block form_help -%}
    {%- set help_attr = help_attr|merge({ class: help_attr.class|default(help_class|default('mt-1 text-blue-100 text-xs italic')) }) -%}
    {{- parent() -}}
{%- endblock form_help -%}

{%- block form_errors -%}
    {%- if errors|length > 0 -%}
        <ul>
            {%- for error in errors -%}
                <li class="{{ error_item_class|default('text-red-700') }}">{{ error.message }}</li>
            {%- endfor -%}
        </ul>
    {%- endif -%}
{%- endblock form_errors -%}

{%- block range_widget -%}
    <div data-controller="form--input-range" class="flex items-end gap-4">
        <div class="w-4/5">
            <div class="flex">
                <div class="flex-1 text-left"><span data-form--input-range-target="min"></span></div>
                <div class="flex-1 text-right"><span data-form--input-range-target="max"></span></div>
            </div>
            <input
                type="range"
                {{ block('widget_attributes') }}
                {% if value is not empty %}value="{{ value }}" {% endif %}
                data-form--input-range-target="range"
                data-action="input->form--input-range#updateValue"
            />
        </div>
        <div class="w-1/5 rounded py2 px-3 text-center bg-lotgd-700 text-gray-100 mb-2" data-form--input-range-target="value"></div>
    </div>
{%- endblock range_widget %}

{# Checkbox toggle style #}

{%- block checkbox_row -%}
    {%- set row_attr = row_attr|merge({ class: row_attr.class|default(row_class|default('md:flex md:items-center mb-6')) }) -%}

    {%- set widget_attr = {attr: {class: 'unstyle hidden'}} -%}

    {%- if help is not empty -%}
        {%- set widget_attr = widget_attr|merge({attr: {'aria-describedby': id ~"_help"}}) -%}
    {%- endif -%}

    {% if not compound -%}
        {% set label_attr = label_attr|merge({'for': id}) %}
    {%- endif -%}

    {% if required -%}
        {% set label_attr = label_attr|merge({'class': (label_attr.class|default('') ~ ' required')|trim}) %}
    {%- endif -%}

    {% if label is empty -%}
        {%- if label_format is not empty -%}
            {% set label = label_format|replace({
                '%name%': name,
                '%id%': id,
            }) %}
        {%- else -%}
            {% set label = name|humanize %}
        {%- endif -%}
    {%- endif -%}

    <label{% if label_attr %}{% with { attr: label_attr|merge(row_attr) } %}{{ block('attributes') }}{% endwith %}{% endif %}>
        <div class="md:w-1/3">
            <div class="block font-bold md:text-right mb-1 md:mb-0 pr-4">
                {%- if translation_domain is same as(false) -%}
                    {{- label -}}
                {%- else -%}
                    {{- label|trans(label_translation_parameters, translation_domain) -}}
                {%- endif -%}
            </div>
        </div>
        <div class="md:w-2/3">
            {{- form_errors(form) -}}

            <div class="relative">
                {{- form_widget(form, widget_attr) -}}
                <!-- path -->
                <div class="toggle-path bg-red-500 w-10 h-5 rounded-full shadow-inner"></div>
                <!-- circle -->
                <div class="toggle-circle absolute w-5 h-5 bg-white rounded-full shadow inset-y-0 left-0"></div>
            </div>

            {{- form_help(form) -}}
        </div>
    </label>
{%- endblock checkbox_row -%}

{# Custom Rows #}

{%- block tagify_row -%}
    <div class="md:flex md:items-center mb-6">
        {{- form_label(form) -}}
        <div class="md:w-2/3">
            {{- form_errors(form) -}}
            <button
                type="button"
                class="unstyle absolute z-10 cursor-pointer rounded-full w-11 h-11 ring-inset ring-2 ring-blue-500 hover:ring-4 text-blue-500"
                id="button-{{ id }}"
            >+</button>

            <input type="text" {{ block('widget_attributes') }} {% if value is not empty %}value="{{ value }}" {% endif %}/>
            {{- form_help(form) -}}
        </div>
    </div>

    <script>
        /* eslint-disable no-undef */
        const input = document.getElementById('{{ id }}')

        const tagify = Lotgd.tagify(input, {
            autocomplete: {
                enabled: false
            },
            dropdown: {
                enabled: false
            }
        })
        const button = document.getElementById('button-{{ id }}')

        button.addEventListener('click', () =>
        {
            tagify.addEmptyTag()
        })
    </script>
{%- endblock tagify_row -%}

{%- block view_only_row -%}
    <div class="md:flex md:items-center mb-6">
        {{- form_label(form) -}}
        {% set value = value|default(form.parent.vars.value[name]) %}
        <div class="md:w-2/3">
            <span class="rounded bg-lotgd-50 text-black py-1 px-3 text-sm">
                {%- if apply_filter -%}
                    {{ value|apply_filter(apply_filter)|uncolorize }}
                {%- else -%}
                    {{ value|uncolorize }}
                {%- endif -%}
            </span>
            {{- form_help(form) -}}
        </div>
    </div>
{%- endblock view_only_row -%}

{%- block translatable_row -%}
    {% set sanitized_name = full_name|replace({'[' : '_', ']' : '_'}) %}

    <div id="{{ sanitized_name }}translatable">
        <div class="ui top attached translatable tabular menu">
            {{- form_label(form) -}}
            {% for locale in locales %}
                <a class="item {{ loop.first ? 'active':'' }}" data-tab="{{ sanitized_name ~ locale ~ "_tab" }}">
                    {{ locale }}
                    {% if locale in required_locale %}
                        <span class="ui text red">*</span>
                    {% endif %}
                </a>
            {% endfor %}
        </div>
        {% for locale in locales %}
            <div class="ui bottom attached tab segment {{ loop.first ? 'active':'' }}" data-tab="{{ sanitized_name ~ locale ~ "_tab" }}">
                {{- form_widget(attribute(form, locale ~ '_' ~ name)) -}}
                {{- form_help(attribute(form, locale ~ '_' ~ name)) -}}
                {{- form_errors(attribute(form, locale ~ '_' ~ name)) -}}
            </div>
        {% endfor %}
    </div>
{%- endblock -%}
